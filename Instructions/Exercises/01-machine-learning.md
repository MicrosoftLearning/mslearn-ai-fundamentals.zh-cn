---
lab:
  title: 探索自动化机器学习
---

# 探索自动化机器学习

在本练习中，你将使用自动化机器学习来训练和评估机器学习模型。 然后，你将部署并测试已训练的模型。

> **注意**：本练习旨在指导你完成使用 Azure 机器学习训练和测试模型的步骤。****** 如果你的 Azure 订阅具有足够的权限，则可以预配 Azure 机器学习工作区并将其用于练习。 然而，Azure 机器学习旨在支持企业级机器学习解决方案，这类解决方案通常涉及海量数据和基于云的计算。 Azure 机器学习中的某些操作需要预配计算，这可能需要相当长的时间。 如果你无法访问 Azure，或者完成练习的时间有限，还可以使用一个基于浏览器的 ML 实验室应用，其中包含本练习中使用的 Azure ML 的核心功能，并且可以使用它来训练和测试真实的机器学习模型，其操作方式与在 Azure ML 中的体验相同。****** 虽然 ML 实验室中的用户界面与 Azure 机器学习不同，但它足以直观展示向 Azure 机器学习过渡的过程。** 请注意，ML 实验室应用是在浏览器中运行的，因此，在任何时候刷新页面都会重启应用！

本练习需要大约 35 分钟才能完成（如果使用基于浏览器的 ML 实验室应用，则需要的时间较少）。****

## 创建工作区

工作区用于将所有机器学习资源放在一起，以便更轻松地在一个统一的位置管理数据、代码、模型和其他资产。

1. 打开要在此实验室中使用的环境的门户，并在出现提示时登录：
    - 基于 Azure 的[Azure 机器学习工作室](https://ml.azure.com){:target="_blank"}：`https://ml.azure.com`
    - 基于浏览器的[ML 实验室](https://aka.ms/ml-lab){:target="_blank"}：`https://aka.ms/ml-lab`

    > **提示**：如果 Azure 机器学习工作室在现有工作区中打开，请导航到“所有工作区”页。****

1. 使用合适的名称创建一个新工作区。

    如果你使用的是 Azure 机器学习，则不需要在本练习中使用中心**。 根据 Azure 订阅中的任何策略约束选择适当的高级设置。

1. 创建工作区后，选择该工作区以查看主页。****

    请注意，工作区包含多个页面，均显示在左侧导航窗格中。 可以使用顶部的 &#9776; 菜单展开和折叠此窗格。****

## 下载数据

在本练习中，你将使用冰淇淋销售数据集来训练一个模型，根据季节性特征和气象特征预测特定日期的冰淇淋需求。

1. 在新的浏览器选项卡中，将****[ml-data.zip](https://aka.ms/mslearn-ml-data) 从`https://aka.ms/mslearn-ml-data` 下载到本地计算机。
1. 提取已下载的 ml-data.zip 存档，查看其中包含的文件。**** 请注意，其中一个文件是 ice-cream.csv，其中包含本练习所需的冰淇淋销售数据。****

## 使用自动化机器学习来训练模型

借助自动化机器学习，可以尝试多种算法和参数来训练多个模型，并确定最适合你的数据的模型。

1. 在门户中，查看“自动化 ML”页（位于“创作”下）。********

1. 通过以下设置创建新自动化 ML 作业，并根据需要使用“下一步”来逐步完成用户界面：

    > **提示**：如果以下步骤中没有为设置提供明确的信息，请使用默认值。

    基本设置：

    - 为自动化机器学习作业分配一个唯一的作业名称****

   任务类型与数据：

    - 将任务类型设置为“回归”。****
    - 创建名为“ice-cream”的新表格数据资产**********
        - 将本地的 ice-cream.csv 文件上传到默认的工作区存储。****
        - <u>仅</u>包含以下列（每个行的“日期”是唯一的，并可自行添加预测功能）：**
            - **DayOfWeek**
            - **月**
            - **温度**
            - Rainfall****
            - IceCreamsSold****
        - 创建数据资产。
    - 在继续下一步之前，请确保已选择新创建的 IceCreamsSold 数据资产****

    > **注意**：如果你使用的 Azure 订阅不是由你管理的，策略可能不允许对存储进行基于密钥的访问。 在这种情况下，需要与管理员协作，以允许基于密钥的访问，或重新配置 Azure 机器学习工作区，使用 Entra ID 身份验证访问存储。 如果无法执行此操作，请使用基于浏览器的 ML 实验室应用完成本练习。******

    任务设置：

    - 将目标列（我们需要模型预测的标签）设置为 IceCreamsSold。********
    - 设置“其他配置设置”：****
        - 将“主要指标”设置为要用于评估模型性能的指标。**** 在本练习中，使用 R<sup>2</sup>** 分数。
        - 选择要尝试使用的模型算法（或将其全部选中）
    - 设置“特征化设置”：****
        - 使用这些设置自定义特征化（为模型训练准备数据特征的方式）
    - 设置“限制”：****
        - 使用限制，可根据具体条件提前结束训练作业。 在本练习中，设置以下限制：
            - **指标分数阈值**：0.9
            - 试验超时（分钟）：**** 15
        
        > 请注意，使用 Azure 机器学习时必须设置这些限制，因为针对每个可能的算法和特征化组合运行训练作业可能需要几个小时才能完成！****

    **计算：**

    - 使用无服务器计算****

    **审阅**

    - 查看设置并仔细检查。 然后提交训练作业。 它会自动启动。

1. 请等待作业完成。

    > **提示**：如果使用 Azure 机器学习，这可能需要一段时间，现在正好可以喝杯咖啡休息一下！

## 查看最佳模型

自动化机器学习作业完成后，可以查看它训练的最佳模型。

1. 在作业详细信息页的“概述”选项卡上，查看有关作业的信息，并记下最佳模型摘要。****
  
1. 选择最佳模型的“算法名称”，以查看其详细信息****。 然后在子作业详细信息页上，查看以下选项卡：
    - **概述**：子作业的常规详细信息。
    - 模型****：有关已训练的模型的信息。
    - “指标”：根据训练过程中使用的测试数据，对模型进行评估的指标和可视化效果。****
    - 输出和日志：**** 在训练过程中记录的信息。

## 部署并测试模型

1. 在通过自动化机器学习作业训练的最佳模型的“模型”选项卡上，选择“部署”，将模型部署到实时终结点。********

    为用于运行已部署终结点的计算选择适当的“实例”和“虚拟机”选项（这可能取决于 Azure 订阅中可用的配额），并分配合适的终结点名称和部署名称。****************

1. 等待提示部署完成的通知。

    > **提示**：在 Azure 机器学习工作室中，终结点部署可能需要 5-10 分钟才能完成。

## 测试已部署的服务

现在，可以测试已部署的服务。

1. 在导航菜单中，选择“终结点”页，并打开已创建的实时终结点。****

1. 在终结点页上，查看“测试”选项卡。****

1. 在“输入数据以测试终结点”窗格中，将模板 JSON 替换为以下输入数据：

    ```json
   {
     "input_data": {
        "columns": [
            "DayOfWeek",
            "Month",
            "Temperature",
            "Rainfall"
        ],
        "index": [0],
        "data": [["Wednesday","June",70.5,0.05]]
     }
   }
    ```

1. 单击“测试”按钮****。

1. 查看测试结果，其中包括根据输入特征预测的租赁次数，与此类似：

    ```JSON
   [
       120.16208168753236
   ]
    ```

    测试窗格采用输入数据，然后使用训练的模型返回预测的租赁次数。

## 查看代码以使用模型

现在你已经有了预测模型，开发人员可以构建应用程序来使用它。

1. 在实时终结点页上，查看“使用”选项卡****。
1. 查看示例代码以使用模型。

## 如果时间允许

如果你想进一步尝试自动化机器学习，可以基于之前下载的 ml-data.zip 存档中包含的 penguins.csv 文件训练分类模型。************ 使用此数据集中的所有列。

训练和部署分类模型后，可以使用以下 JSON 在终结点中对其进行测试：

```json
{
    "input_data": {
    "columns": [
        "CulmenLength",
        "CulmenDepth",
        "FlipperLength",
        "BodyMass"
    ],
    "index": [0],
    "data": [[45.2,13.8,215,4750]]
    }
}
```

## 清理

如果你使用 Azure 机器学习完成了本练习，应删除你创建的资源，避免产生不必要的 Azure 使用费用。

1. 在 Azure 机器学习工作室的“终结点”选项卡上，选择你部署的终结点[](https://ml.azure.com)****。 然后选择“删除”，并确认是否要删除该终结点。

    删除计算可确保不会向你的订阅收取计算资源的费用。 但是，只要订阅中存在 Azure 机器学习工作区，就会向你收取少量数据存储费用。 如果已完成对 Azure 机器学习的探索，可以删除 Azure 机器学习工作区和关联的资源。

删除工作区的步骤：

1. 在[Azure 门户](https://portal.azure.com)的“资源组”页中，打开在创建 Azure 机器学习工作区时指定的资源组。
2. 单击“删除资源组”，键入资源组名称以确认要删除资源组，然后选择“删除”。
